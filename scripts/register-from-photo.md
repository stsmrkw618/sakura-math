# 写真から問題登録

## テスト写真の保存場所

テスト用紙の写真は以下のフォルダ構造で管理する:

```
problem/
├── 2026-01/          # 2026年1月のテスト
│   ├── xxxxxxxx.jpg
│   └── ...
├── 2026-02/          # 2026年2月のテスト
│   ├── 20260222_131719.jpg
│   └── 20260222_131729.jpg
└── YYYY-MM/          # テスト実施月でフォルダを分ける
```

- フォルダ名: `YYYY-MM` 形式（テスト実施月）
- 写真ファイル: スマホ撮影のまま（ファイル名は任意）
- このフォルダは `.gitignore` でGit管理対象外

## 手順
テスト用紙の写真が添付されたら、以下を実行してください。

1. 画像から問題文を読み取る
2. ユーザーが指定した問題番号の問題を抽出する
3. **図形の判定と処理**:
   - 図がない問題 → `figure: null`
   - シンプルな図形（三角形、四角形、円、角度の図など）
     → SVGコードを生成して `figure: { type: "svg", svg: "...", description: "..." }` に設定
     → SVGルール: viewBox="0 0 200 160"、線は#374151、補助線は#F472B6の点線、ラベルはfont-size 14
   - 複雑な図形（立体、展開図、複雑な重なりなど）
     → `figure: { type: "image", path: "figures/{問題ID}.png", description: "..." }` に設定
     → 「この問題の図は写真からトリミングが必要です。元写真: `problem/YYYY-MM/ファイル名`」と通知
4. 各問題について分析:
   - tags: data/problems.json の tags 定義から1〜3個選択
   - difficulty: 基礎 / 標準 / 発展
   - stumblingPoint: 小学生がつまずきやすいポイント（1-2文）
5. 答えと解き方を作成（小学生向けの丁寧な解説）
6. ID採番: 既存の最大ID + 1（"YYYY-MM-NNN"形式。YYYYとMMはテスト実施月に合わせる）

## ★必須: OCR精度確認ステップ（問題文の転記ミス防止）

**JSONに書き込む前に、以下の確認を必ず行うこと。**

### ステップA: 問題文の書き起こしを1問ずつ提示

各問題について、以下のフォーマットでユーザーに確認を求める:

```
📝 OCR読み取り結果の確認

【大問○(○)】正答率: ○○%
問題文:
「（読み取った問題文をそのまま表示）」

答え:
（生成した模範解答）

→ この問題文は正しいですか？ 修正があれば教えてください。
```

### ステップB: 確認ポイント（特にミスが起きやすい箇所）

OCRで以下の点は特に間違いやすいため、明示的に確認する:
- **数字**: 1↔2, 6↔8, 3↔5 など（「消しゴム2個」と「消しゴム1個」の違いで答えが変わる）
- **小問番号の対応**: (1)(2)(3)の問題文が正しい小問番号に紐づいているか
- **連立問題の前提関係**: 大問の(1)(2)(3)が互いに参照し合う場合、問いの順序を間違えると答えが全部ずれる
- **選択肢・条件の読み落とし**: 「0以外の整数で」等の追加条件
- **図形の読み取り**: てんびんの左右、図形の辺の長さ等

### ステップC: 全問確認後に一括登録

ユーザーから全問OKの返答を得てから、data/problems.json に追記する。
1問でも修正がある場合は、修正後に再度確認を求める。

## 注意
- 問題文は原文のまま忠実に転記する（誤字修正はしない）
- 図形問題は図の情報を漏れなくテキスト化する
- 解き方は小4が理解できるレベルの説明にする
- 1度に複数問題を登録する場合、すべてまとめて表示してから一括確認
- **写真の角度や印刷の不鮮明さで読み取りにくい場合は、推測せず「この箇所が読み取れません」と正直に伝える**
